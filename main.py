import tkinter as tk
from tkinter import filedialog, messagebox
from scanner import scan_directory, load_virus_rules

def show_scan_result(infected_files):
    if not infected_files:
        messagebox.showinfo('Scan result', 'No virus detected!')
    else:
        msg = f'{len(infected_files)} infected file(s) detected.\n\n'
        msg += 'The following files are infected:\n\n'
        msg += '\n'.join(infected_files)
        if messagebox.askyesno('Scan result', f'{msg}\n\nDelete infected files?'):
            for file in infected_files:
                try:
                    os.remove(file)
                except Exception as e:
                    messagebox.showerror('Deletion Error', f'Error deleting {file}: {e}')
            messagebox.showinfo('Scan result', f'{len(infected_files)} file(s) deleted!')

def scan_files():
    root = tk.Tk()
    root.withdraw()
    rule_path = filedialog.askopenfilename(title="Select virus detection rule file")
    if rule_path:
        virus_rules = load_virus_rules(rule_path)
        dir_path = filedialog.askdirectory(title="Select directory to scan")
        if dir_path:
            infected_files = scan_directory(dir_path, virus_rules)
            show_scan_result(infected_files)

if __name__ == '__main__':
    scan_files()
